filePath("/Users/joed/PES_Project/Vernalis_EGRET/")
#filePath <- "C:/Users/dsaleh/Documents/GitHub/PES_Project/Vernalis_EGRET/"
filePath <- ("/Users/joed/PES_Project/Vernalis_EGRET/")
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
##Set fileName to combined Kratzer and NWIS data set
fileName <- "NWIS_and_Kratzer_TP.csv"
Sample <- readUserSample(filePath, fileName)
View(Sample)
removeDuplicates(Sample)
#Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
INFO <- readNWISInfo(siteNumber = siteNumber, parameterCd = parameterCd, interactive=FALSE)
INFO$staAbbrev <- paste(strsplit(INFO$station_nm," ")[[1]][1],strsplit(INFO$station_nm," ")[[1]][2])
# Have a look at the available range of TP data
range(Sample$Date)
#"1971-10-14" "2019-05-07"
eList <- mergeReport(INFO, Daily, Sample)
# Change the working directory; redirect plot output to TP folder
setwd("/Users/joed/PES_Project/Vernalis_EGRET/")
subDir <- 'TP/EGRET_plots'
if (file.exists(subDir)){
setwd(file.path(getwd(),subDir))
} else {
dir.create(file.path(getwd(),subDir), recursive=TRUE)
setwd(file.path(getwd(),subDir))
}
# Plot water quality data
tiff("Conc_vs_Time_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotConcTime(eList)
dev.off()
# Now, a classic Q-C plot
tiff("Conc-Q_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotConcQ(eList, logScale=TRUE)
dev.off()
# The data set as flux values rather than as concentrations
tiff("Flux-Q_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotFluxQ(eList, fluxUnit=4)
dev.off()
# Monthly boxplots
tiff("Monthly-Conc_BoxPlots_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
boxConcMonth(eList, logScale=TRUE)
dev.off()
# Plot water quality data
tiff("Conc_vs_Time_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotConcTime(eList)
dev.off()
# Now, a classic Q-C plot
tiff("Conc-Q_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotConcQ(eList, logScale=TRUE)
dev.off()
# The data set as flux values rather than as concentrations
tiff("Flux-Q_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotFluxQ(eList, fluxUnit=4)
dev.off()
# Monthly boxplots
tiff("Monthly-Conc_BoxPlots_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
boxConcMonth(eList, logScale=TRUE)
dev.off()
# Flow on days sampled vs. all other days
tiff("Flow_on_days_sampled_vs_all_other_days_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
boxQTwice(eList, qUnit=1)
dev.off()
# Build the regression model
eList <- modelEstimation(eList, windowY = 7, windowQ = 2, windowS = 0.5, minNumObs = 100, minNumUncen =50)
eList_TP <- eList
MonthlyResults <- calculateMonthlyResults(eList)
# Dump TP-related flow-normalized data to text file for bringing together with other monitoring sites
paLong <- 12
paStart <- 10
localDaily <- getDaily(eList_TP)
localAnnualResults <- setupYears(paStart = paStart, paLong = paLong, localDaily = localDaily)
write.table(localAnnualResults, file = '_TP_RawVals.txt', quote=FALSE, row.names=FALSE)
MonthlyResults <- calculateMonthlyResults(eList)
# Dump TP-related flow-normalized data to text file for bringing together with other monitoring sites
paLong <- 12
paStart <- 10
localDaily <- getDaily(eList_TP)
localAnnualResults <- setupYears(paStart = paStart, paLong = paLong, localDaily = localDaily)
write.table(localAnnualResults, file = '_TP_RawVals.txt', quote=FALSE, row.names=FALSE)
write.csv(Daily,"localDailyTP.csv")
# Plot the annual average concentration and annual flow-normalized concentration
tiff("Ann_Avg_Conc_&_Ann_Flow_Normalized_Conc_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotConcHist(eList, plotFlowNorm=TRUE)
dev.off()
# Plot the annual flux and annual flow-normalized flux
tiff("Ann_Flux_&_Ann_Flow_Normalized_Flux_SanJVernalis_TP.tif", height = 600, width = 800, res=120)
plotFluxHist(eList, plotFlowNorm = TRUE) # fluxMax) # fluxMax
dev.off()
# Look for a trend change:
tableChange(eList, fluxUnit=6, yearPoints=c(1971,1981,1991,2001,2011))
#1991  to  2006     -0.00044       -3e-05          -30           -2
#1991  to  2011     -0.00034     -1.7e-05          -23         -1.2
#1996  to  2001     -3.4e-05     -6.9e-06         -3.4        -0.69
#1996  to  2006      2.2e-05      2.2e-06          2.2         0.22
#1996  to  2011      0.00012      8.1e-06           12         0.82
#2001  to  2006      5.6e-05      1.1e-05          5.9          1.2
#2001  to  2011      0.00016      1.6e-05           16          1.6
#2006  to  2011        1e-04        2e-05          9.8            2
#
#Generate out-of-the-box diagnostic plots
tiff("fluxBiasMulti_SanJVernalis_TP.tif", height = 1200, width = 1000, res=120)
fluxBiasMulti(eList, moreTitle = "WRTDS")
dev.off()
startDate <- "1970-06-01"
endDate <- "2019-09-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "00608"  # "NH4"
#fileName <- "_NH3.csv"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
View(Sample)
write.csv(Sample."NWIS_NH3.csv")
write.csv(Sample,"NWIS_NH3.csv")
#fileName <- "_NH3.csv"
filePath <- "/Users/joed/PES_Project/Vernalis_EGRET/"
startDate <- "1974-10-02"
endDate <- "2019-05-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "00608"  # "NH4"
#fileName <- "_NH3.csv"
filePath <- "/Users/joed/PES_Project/Vernalis_EGRET/"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
View(Daily)
fileName <- "NWIS_and_Kratzer_NH3.csv"
View(Sample)
Sample <- readUserSample(filePath, fileName)
View(Sample)
#Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
#write.csv(Sample,"NWIS_NH3.csv")
INFO <- readNWISInfo(siteNumber = siteNumber, parameterCd = parameterCd, interactive=FALSE)
INFO$staAbbrev <- paste(strsplit(INFO$station_nm," ")[[1]][1],strsplit(INFO$station_nm," ")[[1]][2])
# Have a look at the available range of NH3 data
range(Sample$Date)
#"1974-10-02" "2019-05-07"
eList <- mergeReport(INFO, Daily, Sample)
# Change the working directory; redirect plot output to NH4 folder
setwd("../..")
subDir <- 'NH4/EGRET_plots'
if (file.exists(subDir)){
setwd(file.path(getwd(),subDir))
} else {
dir.create(file.path(getwd(),subDir), recursive=TRUE)
setwd(file.path(getwd(),subDir))
}
plotConcTime(eList)
# Plot water quality data
tiff("Conc_vs_Time_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
plotConcTime(eList)
dev.off()
plotConcTime(eList)
# Now, a classic Q-C plot
tiff("Conc-Q_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
plotConcQ(eList, logScale=TRUE)
dev.off()
plotConcQ(eList, logScale=TRUE)
# The data set as flux values rather than as concentrations
tiff("Flux-Q_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
plotFluxQ(eList, fluxUnit=4)
dev.off()
# Monthly boxplots
tiff("Monthly-Conc_BoxPlots_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
boxConcMonth(eList, logScale=TRUE)
dev.off()
# Flow on days sampled vs. all other days
tiff("Flow_on_days_sampled_vs_all_other_days_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
boxQTwice(eList, qUnit=1)
dev.off()
# Build the regression model
eList <- modelEstimation(eList, windowY = 7, windowQ = 2, windowS = 0.5, minNumObs = 100, minNumUncen =50)
eList_NH3 <- eList
MonthlyResults <- calculateMonthlyResults(eList)
# Dump NH3-related flow-normalized data to text file for bringing together with other monitoring sites
paLong <- 12
paStart <- 10
localDaily <- getDaily(eList_NH3)
localAnnualResults <- setupYears(paStart = paStart, paLong = paLong, localDaily = localDaily)
write.table(localAnnualResults, file = '_NH3_RawVals.txt', quote=FALSE, row.names=FALSE)
write.csv(Daily,'localDailyNH3.csv')
# Plot the annual average concentration and annual flow-normalized concentration
tiff("Ann_Avg_Conc_&_Ann_Flow_Normalized_Conc_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
plotConcHist(eList, plotFlowNorm=TRUE)
dev.off()
# Plot the annual flux and annual flow-normalized flux
tiff("Ann_Flux_&_Ann_Flow_Normalized_Flux_SanJVernalis_NH4.tif", height = 600, width = 800, res=120)
plotFluxHist(eList, plotFlowNorm = TRUE) # fluxMax) # fluxMax
dev.off()
write.table(localAnnualResults, file = 'Vernalis_NH3_RawVals.txt', quote=FALSE, row.names=FALSE)
#############################################################
# Working on SSC
#############################################################
startDate <- "1970-06-01"
endDate <- "2019-05-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "80154"  # "SSC"
#fileName <- "_SSC.csv"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
#Sample <- readUserSample(filePath, fileName)
Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
View(Sample)
OP line 1119##
# Load required libraries
library(EGRET)
library(dataRetrieval)
library(rloadest)
library(EGRETci)
library(foreach)
library(doParallel)
library(iterators)
library(zoo)
library(plotrix)
library(lubridate)
library(changepoint)
library(corrplot)
library(RColorBrewer)
library(plotly)
library(ggplot2)
library(viridis)
library(fields)
library(extrafont)
loadfonts()
#############################################################
# Working on SSC
#############################################################
startDate <- "1970-10-01"
endDate <- "2018-12-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "80154"  # "SSC"
#fileName <- "_SSC.csv"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
#Sample <- readUserSample(filePath, fileName)
Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
INFO <- readNWISInfo(siteNumber = siteNumber, parameterCd = parameterCd, interactive=FALSE)
INFO$staAbbrev <- paste(strsplit(INFO$station_nm," ")[[1]][1],strsplit(INFO$station_nm," ")[[1]][2])
# Have a look at the available range of TP data
range(Sample$Date)
#"1990-06-07" "2011-09-06"
eList <- mergeReport(INFO, Daily, Sample)
# Have a look at the available range of TP data
range(Sample$Date)
#"1970-12-01" "2018-12-19"
eList <- mergeReport(INFO, Daily, Sample)
# Change the working directory; redirect plot output to NH3 folder
setwd("../..")
subDir <- 'SSC/EGRET_plots'
if (file.exists(subDir)){
setwd(file.path(getwd(),subDir))
} else {
dir.create(file.path(getwd(),subDir), recursive=TRUE)
setwd(file.path(getwd(),subDir))
}
plotConcTime(eList)
# Plot water quality data
tiff("Conc_vs_Time_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcTime(eList)
dev.off()
# Now, a classic Q-C plot
tiff("Conc-Q_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcQ(eList, logScale=TRUE)
dev.off()
# The data set as flux values rather than as concentrations
tiff("Flux-Q_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotFluxQ(eList, fluxUnit=4)
dev.off()
# Monthly boxplots
tiff("Monthly-Conc_BoxPlots_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
boxConcMonth(eList, logScale=TRUE)
dev.off()
# Flow on days sampled vs. all other days
tiff("Flow_on_days_sampled_vs_all_other_days_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
boxQTwice(eList, qUnit=1)
dev.off()
# Build the regression model
eList <- modelEstimation(eList, windowY = 7, windowQ = 2, windowS = 0.5, minNumObs = 100, minNumUncen =50)
MonthlyResults <- calculateMonthlyResults(eList)
# Dump SSC-related flow-normalized data to text file for bringing together with other monitoring sites
paLong <- 12
paStart <- 10
localDaily <- getDaily(eList)
localAnnualResults <- setupYears(paStart = paStart, paLong = paLong, localDaily = localDaily)
write.table(localAnnualResults, file = '_SSC_RawVals.txt', quote=FALSE, row.names=FALSE)
write.csv(Daily,'localDaily_Vern_SSC.csv')
# Plot the annual average concentration and annual flow-normalized concentration
tiff("Ann_Avg_Conc_&_Ann_Flow_Normalized_Conc_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcHist(eList, plotFlowNorm=TRUE)
dev.off()
# Plot the annual flux and annual flow-normalized flux
tiff("Ann_Flux_&_Ann_Flow_Normalized_Flux_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotFluxHist(eList, plotFlowNorm = TRUE) # fluxMax) # fluxMax
dev.off()
# Look for a trend change:
tableChange(eList, fluxUnit=6, yearPoints=c(1990,1998,2011))
#1991  to  2006        -0.62       -0.041          -59         -3.9
#1991  to  2011        -0.52       -0.026          -49         -2.5
#1996  to  2001       -0.043      -0.0085          -10           -2
#1996  to  2006       0.0045      0.00045          1.1         0.11
#1996  to  2011         0.11       0.0072           25          1.7
#2001  to  2006        0.047       0.0095           12          2.5
#2001  to  2011         0.15        0.015           39          3.9
#2006  to  2011          0.1        0.021           24          4.8
#
#Generate out-of-the-box diagnostic plots
tiff("fluxBiasMulti_SanJVernalis_SSC.tif", height = 1200, width = 1000, res=120)
fluxBiasMulti(eList, moreTitle = "WRTDS")
dev.off()
tiff("Modeled_Daily_Conc_wObservations_SanJVernalis_SSC.tif", height = 800, width = 1000, res=120)
plotConcTimeDaily(eList)
dev.off()
# Exploring model behavior and adjusting model parameters
tiff("Contours_SanJVernalis_SSC.tif", height = 700, width = 1000, res=120)
plotContours(eList, qBottom=0.03,qTop=10,yearStart=1990,yearEnd=2011, contourLevels=seq(0,50,by=1), color.palette = colorRampPalette(c("violet", "purple", "blue", "cyan", "green", "yellow", "orange", "red")))
dev.off()
tiff("Log_Contours_SanJVernalis_SSC.tif", height = 700, width = 1000, res=120)
plotContours(eList, qBottom=0.03, qTop=10, yearStart=1990, yearEnd=2011, contourLevels=seq(-2.4,4,by=0.1), color.palette = colorRampPalette(c("violet", "purple", "blue", "cyan", "green", "yellow", "orange", "red")), whatSurface=1)
dev.off()
INFO
View(Sample)
View(Daily)
Load required libraries
library(EGRET)
library(dataRetrieval)
library(rloadest)
library(EGRETci)
library(foreach)
library(doParallel)
library(iterators)
library(zoo)
library(plotrix)
library(lubridate)
library(changepoint)
library(corrplot)
library(RColorBrewer)
library(plotly)
library(ggplot2)
library(viridis)
library(fields)
library(extrafont)
loadfonts()
#############################################################
# Working on SSC
#############################################################
startDate <- "1970-10-01"
endDate <- "2018-12-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "80154"  # "SSC"
#fileName <- "_SSC.csv"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
#Sample <- readUserSample(filePath, fileName)
Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
INFO <- readNWISInfo(siteNumber = siteNumber, parameterCd = parameterCd, interactive=FALSE)
INFO$staAbbrev <- paste(strsplit(INFO$station_nm," ")[[1]][1],strsplit(INFO$station_nm," ")[[1]][2])
# Have a look at the available range of TP data
range(Sample$Date)
#"1970-12-01" "2018-12-19"
eList <- mergeReport(INFO, Daily, Sample)
# Change the working directory; redirect plot output to NH3 folder
setwd("../..")
subDir <- 'SSC/EGRET_plots'
if (file.exists(subDir)){
setwd(file.path(getwd(),subDir))
} else {
dir.create(file.path(getwd(),subDir), recursive=TRUE)
setwd(file.path(getwd(),subDir))
}
plotConcTime(eList)
# Plot water quality data
tiff("Conc_vs_Time_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcTime(eList)
dev.off()
P line 1119##
# Load required libraries
library(EGRET)
library(dataRetrieval)
library(rloadest)
library(EGRETci)
library(foreach)
library(doParallel)
library(iterators)
library(zoo)
library(plotrix)
library(lubridate)
library(changepoint)
library(corrplot)
library(RColorBrewer)
library(plotly)
library(ggplot2)
library(viridis)
library(fields)
library(extrafont)
loadfonts()
#############################################################
# Working on SSC
#############################################################
startDate <- "1970-10-01"
endDate <- "2018-12-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "80154"  # "SSC"
#fileName <- "_SSC.csv"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
#Sample <- readUserSample(filePath, fileName)
Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
INFO <- readNWISInfo(siteNumber = siteNumber, parameterCd = parameterCd, interactive=FALSE)
INFO$staAbbrev <- paste(strsplit(INFO$station_nm," ")[[1]][1],strsplit(INFO$station_nm," ")[[1]][2])
# Have a look at the available range of TP data
range(Sample$Date)
#"1970-12-01" "2018-12-19"
eList <- mergeReport(INFO, Daily, Sample)
# Load required libraries
library(EGRET)
library(dataRetrieval)
library(rloadest)
library(EGRETci)
library(foreach)
library(doParallel)
library(iterators)
library(zoo)
library(plotrix)
library(lubridate)
library(changepoint)
library(corrplot)
library(RColorBrewer)
library(plotly)
library(ggplot2)
library(viridis)
library(fields)
library(extrafont)
loadfonts()
#############################################################
# Working on SSC
#############################################################
startDate <- "1970-10-01"
endDate <- "2018-12-30"
siteNumber <- "11303500"
QParameterCd <- "00060"
parameterCd <- "80154"  # "SSC"
#fileName <- "_SSC.csv"
Daily <- readNWISDaily(siteNumber, QParameterCd, startDate, endDate)
#Sample <- readUserSample(filePath, fileName)
Sample <- readNWISSample(siteNumber, parameterCd, startDate, endDate)
removeDuplicates(Sample)
INFO <- readNWISInfo(siteNumber = siteNumber, parameterCd = parameterCd, interactive=FALSE)
INFO$staAbbrev <- paste(strsplit(INFO$station_nm," ")[[1]][1],strsplit(INFO$station_nm," ")[[1]][2])
# Have a look at the available range of TP data
range(Sample$Date)
#"1970-12-01" "2018-12-19"
eList <- mergeReport(INFO, Daily, Sample)
# Change the working directory; redirect plot output to NH3 folder
setwd("../..")
subDir <- 'SSC/EGRET_plots'
if (file.exists(subDir)){
setwd(file.path(getwd(),subDir))
} else {
dir.create(file.path(getwd(),subDir), recursive=TRUE)
setwd(file.path(getwd(),subDir))
}
plotConcTime(eList)
# Plot water quality data
tiff("Conc_vs_Time_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcTime(eList)
dev.off()
# Now, a classic Q-C plot
tiff("Conc-Q_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcQ(eList, logScale=TRUE)
dev.off()
# The data set as flux values rather than as concentrations
tiff("Flux-Q_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotFluxQ(eList, fluxUnit=4)
dev.off()
# Monthly boxplots
tiff("Monthly-Conc_BoxPlots_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
boxConcMonth(eList, logScale=TRUE)
dev.off()
# Flow on days sampled vs. all other days
tiff("Flow_on_days_sampled_vs_all_other_days_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
boxQTwice(eList, qUnit=1)
dev.off()
# Build the regression model
eList <- modelEstimation(eList, windowY = 7, windowQ = 2, windowS = 0.5, minNumObs = 100, minNumUncen =50)
MonthlyResults <- calculateMonthlyResults(eList)
# Dump SSC-related flow-normalized data to text file for bringing together with other monitoring sites
paLong <- 12
paStart <- 10
localDaily <- getDaily(eList)
localAnnualResults <- setupYears(paStart = paStart, paLong = paLong, localDaily = localDaily)
write.table(localAnnualResults, file = '_SSC_RawVals.txt', quote=FALSE, row.names=FALSE)
write.csv(Daily,'localDaily_Vern_SSC.csv')
View(Daily)
# Plot the annual average concentration and annual flow-normalized concentration
tiff("Ann_Avg_Conc_&_Ann_Flow_Normalized_Conc_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotConcHist(eList, plotFlowNorm=TRUE)
dev.off()
# Plot the annual flux and annual flow-normalized flux
tiff("Ann_Flux_&_Ann_Flow_Normalized_Flux_SanJVernalis_SSC.tif", height = 600, width = 800, res=120)
plotFluxHist(eList, plotFlowNorm = TRUE) # fluxMax) # fluxMax
dev.off()
# Look for a trend change:
tableChange(eList, fluxUnit=6, yearPoints=c(1990,1998,2011))
#1991  to  2006        -0.62       -0.041          -59         -3.9
#1991  to  2011        -0.52       -0.026          -49         -2.5
#1996  to  2001       -0.043      -0.0085          -10           -2
#1996  to  2006       0.0045      0.00045          1.1         0.11
#1996  to  2011         0.11       0.0072           25          1.7
#2001  to  2006        0.047       0.0095           12          2.5
#2001  to  2011         0.15        0.015           39          3.9
#2006  to  2011          0.1        0.021           24          4.8
#
#Generate out-of-the-box diagnostic plots
tiff("fluxBiasMulti_SanJVernalis_SSC.tif", height = 1200, width = 1000, res=120)
