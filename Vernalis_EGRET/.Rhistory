# ---------------
early_decade_monthly_flx <- aggregate(FluxDay ~ MonthSeq, data = early_decade, 'sum')
recent_decade_monthly_flx <- aggregate(FluxDay ~ MonthSeq, data = recent_decade, 'sum')
# early_decade_monthly_mn$month <- format(seq(as.Date('1972-10-01'), as.Date('1982-09-30'), by='month'), '%b')
early_decade_monthly_flx$month <- rep(c(10:12,1:9), times=10)
early_decade_mon_mn_flx <- aggregate(FluxDay ~ month, data = early_decade_monthly_flx, 'mean')
early_decade_mon_sd_flx <- aggregate(FluxDay ~ month, data = early_decade_monthly_flx, 'sd')
early_decade_mon_mn_flx <- early_decade_mon_mn_flx[c(10:12,1:9),]
early_decade_mon_sd_flx <- early_decade_mon_sd_flx[c(10:12,1:9),]
recent_decade_monthly_flx$month <- rep(c(10:12,1:9), times=10)
recent_decade_mon_mn_flx <- aggregate(FluxDay ~ month, data = recent_decade_monthly_flx, 'mean')
recent_decade_mon_sd_flx <- aggregate(FluxDay ~ month, data = recent_decade_monthly_flx, 'sd')
recent_decade_mon_mn_flx <- recent_decade_mon_mn_flx[c(10:12,1:9),]
recent_decade_mon_sd_flx <- recent_decade_mon_sd_flx[c(10:12,1:9),]
mdat3 <- matrix(c(early_decade_mon_mn_flx$FluxDay, recent_decade_mon_mn_flx$FluxDay),
nrow=2,ncol = 12, byrow=TRUE,
dimnames = list(c("1972-1982", "2009-2019"),
c(format(seq(as.Date('1973-10-01'), as.Date('1974-09-01'), by='month'), '%b'))))
mx <- max(c((early_decade_mon_mn_flx$FluxDay + early_decade_mon_sd_flx$FluxDay), (recent_decade_mon_mn_flx$FluxDay + recent_decade_mon_sd_flx$FluxDay)))
tiff("timing_shift_in_NO3_load_monthly_means.tif", height=800, width=900, res=130)
x <- barplot(mdat3, beside=TRUE, las=1, ylim=c(0,mx), col = c("lightblue", "mistyrose"))
abline(h=0)
arrows(x0=x[1,], y0=early_decade_mon_mn_flx$FluxDay - early_decade_mon_sd_flx$FluxDay, x1=x[1,], y1=early_decade_mon_mn_flx$FluxDay + early_decade_mon_sd_flx$FluxDay, angle=90, length=0.04, code=3)
arrows(x0=x[2,], y0=recent_decade_mon_mn_flx$FluxDay - recent_decade_mon_sd_flx$FluxDay, x1=x[2,], y1=recent_decade_mon_mn_flx$FluxDay + recent_decade_mon_sd_flx$FluxDay, angle=90, length=0.04, code=3)
mtext(side=2, expression(paste(NO[3],', kg ',month^-1,sep='')), line=2.5)
legend(x=30, y=0.9 * mx, c("1972-1982", "2009-2019"), pch=c(22,22), pt.cex=2, pt.bg=c("lightblue", "mistyrose"), bty='n', xpd=TRUE)
dev.off()
# Apply Wilcox.text to the monthly loads here...
early_jan_flx <- subset(early_decade_monthly_flx, month==1)
recent_jan_flx <- subset(recent_decade_monthly_flx, month==1)
SanJ_Vernalis_NO3_flux_jan_wilcox <- wilcox.test(recent_jan_flx$FluxDay, early_jan_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_feb_flx <- subset(early_decade_monthly_flx, month==2)
recent_feb_flx <- subset(recent_decade_monthly_flx, month==2)
SanJ_Vernalis_NO3_flux_feb_wilcox <- wilcox.test(recent_feb_flx$FluxDay, early_feb_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_mar_flx <- subset(early_decade_monthly_flx, month==3)
recent_mar_flx <- subset(recent_decade_monthly_flx, month==3)
SanJ_Vernalis_NO3_flux_mar_wilcox <- wilcox.test(recent_mar_flx$FluxDay, early_mar_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_apr_flx <- subset(early_decade_monthly_flx, month==4)
recent_apr_flx <- subset(recent_decade_monthly_flx, month==4)
SanJ_Vernalis_NO3_flux_apr_wilcox <- wilcox.test(recent_apr_flx$FluxDay, early_apr_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_may_flx <- subset(early_decade_monthly_flx, month==5)
recent_may_flx <- subset(recent_decade_monthly_flx, month==5)
SanJ_Vernalis_NO3_flux_may_wilcox <- wilcox.test(recent_may_flx$FluxDay, early_may_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_jun_flx <- subset(early_decade_monthly_flx, month==6)
recent_jun_flx <- subset(recent_decade_monthly_flx, month==6)
SanJ_Vernalis_NO3_flux_jun_wilcox <- wilcox.test(recent_jun_flx$FluxDay, early_jun_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_jul_flx <- subset(early_decade_monthly_flx, month==7)
recent_jul_flx <- subset(recent_decade_monthly_flx, month==7)
SanJ_Vernalis_NO3_flux_jul_wilcox <- wilcox.test(recent_jul_flx$FluxDay, early_jul_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_aug_flx <- subset(early_decade_monthly_flx, month==8)
recent_aug_flx <- subset(recent_decade_monthly_flx, month==8)
SanJ_Vernalis_NO3_flux_aug_wilcox <- wilcox.test(recent_aug_flx$FluxDay, early_aug_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_sep_flx <- subset(early_decade_monthly_flx, month==9)
recent_sep_flx <- subset(recent_decade_monthly_flx, month==9)
SanJ_Vernalis_NO3_flux_sep_wilcox <- wilcox.test(recent_sep_flx$FluxDay, early_sep_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_oct_flx <- subset(early_decade_monthly_flx, month==10)
recent_oct_flx <- subset(recent_decade_monthly_flx, month==10)
SanJ_Vernalis_NO3_flux_oct_wilcox <- wilcox.test(recent_oct_flx$FluxDay, early_oct_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_nov_flx <- subset(early_decade_monthly_flx, month==11)
recent_nov_flx <- subset(recent_decade_monthly_flx, month==11)
SanJ_Vernalis_NO3_flux_nov_wilcox <- wilcox.test(recent_nov_flx$FluxDay, early_nov_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
early_dec_flx <- subset(early_decade_monthly_flx, month==12)
recent_dec_flx <- subset(recent_decade_monthly_flx, month==12)
SanJ_Vernalis_NO3_flux_dec_wilcox <- wilcox.test(recent_dec_flx$FluxDay, early_dec_flx$FluxDay, exact=TRUE, conf.int = TRUE, conf.level = 0.9)
Flux_compare <- data.frame(chng_est=c(SanJ_Vernalis_NO3_flux_oct_wilcox$est,
SanJ_Vernalis_NO3_flux_nov_wilcox$est,
SanJ_Vernalis_NO3_flux_dec_wilcox$est,
SanJ_Vernalis_NO3_flux_jan_wilcox$est,
SanJ_Vernalis_NO3_flux_feb_wilcox$est,
SanJ_Vernalis_NO3_flux_mar_wilcox$est,
SanJ_Vernalis_NO3_flux_apr_wilcox$est,
SanJ_Vernalis_NO3_flux_may_wilcox$est,
SanJ_Vernalis_NO3_flux_jun_wilcox$est,
SanJ_Vernalis_NO3_flux_jul_wilcox$est,
SanJ_Vernalis_NO3_flux_aug_wilcox$est,
SanJ_Vernalis_NO3_flux_sep_wilcox$est),
low_conf=c(SanJ_Vernalis_NO3_flux_oct_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_nov_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_dec_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_jan_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_feb_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_mar_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_apr_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_may_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_jun_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_jul_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_aug_wilcox$conf.int[1],
SanJ_Vernalis_NO3_flux_sep_wilcox$conf.int[1]),
up_conf=c(SanJ_Vernalis_NO3_flux_oct_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_nov_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_dec_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_jan_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_feb_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_mar_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_apr_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_may_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_jun_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_jul_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_aug_wilcox$conf.int[2],
SanJ_Vernalis_NO3_flux_sep_wilcox$conf.int[2]))
write.table(Flux_compare, "SanJ_Vernalis_NO3_flux_wilcox.txt", quote=FALSE, row.names=FALSE)
rng_flx <- max(abs(c(Flux_compare$up_conf, Flux_compare$low_conf)))
tiff("SanJ_Vernalis_NO3_flux_shift_wilcox_Vert_Bars.tif", height=600, width=800, res=130)
par(mar=c(4,5,0.5,0.5))
plot(seq(1:12), Flux_compare$chng_est, typ='h', lend=1, lwd=15, col='white', xaxt='n', xlim=c(1,13), ylim=c(-rng_flx, rng_flx), xlab="Month", ylab=expression(paste("Median Flux Change, kg",sep='')), las=1)
plotCI(seq(1:12), Flux_compare$chng_est, ui=Flux_compare$up_conf, li=Flux_compare$low_conf, pch=16, add=TRUE)
abline(h=0)
axis(side=1,at=seq(1,12,by=1), labels=format(c(seq(as.Date("2000-10-01"), as.Date("2000-12-01"), by="month"), seq(as.Date("2000-01-01"), as.Date("2000-09-01"), by="month")),'%b'), las=2)
legend('topright', c("Median difference", "90% Confidence Interval for the Median"), pch=c(16,NA), lwd=c(NA,1), pt.cex=c(1,NA), pt.bg=c('black',NA), bty='n', bg='white')
dev.off()
# End of non-standard EGRET plot section requested by Michael
# --------------------------------------------------------------------------------------------------------
# Plot the annual average concentration and annual flow-normalized concentration
tiff("Ann_Avg_Conc_&_Ann_Flow_Normalized_Conc_UpperTruckee_SouthUT5.tif", height = 600, width = 800, res=120)
plotConcHist(eList, plotFlowNorm=TRUE)
dev.off()
# Plot the annual average concentration and annual flow-normalized concentration
pdf("Ann_Avg_Conc_&_Ann_Flow_Normalized_Conc_UpperTruckee_SouthUT5.pdf")
plotConcHist(eList, plotFlowNorm=TRUE, tinyPlot=TRUE,yearEnd = 2015)
dev.off()
plotConcHist(eList, plotFlowNorm=TRUE, printTitle=FALSE)
# Plot the annual flux and annual flow-normalized flux
tiff("Ann_Flux_&_Ann_Flow_Normalized_Flux_UpperTruckee_SouthUT5.tif", height = 600, width = 800, res=120)
plotFluxHist(eList, plotFlowNorm = TRUE) # fluxMax) # fluxMax
dev.off()
# Look for a trend change:
tableChange(eList, fluxUnit=6, yearPoints=c(1990,2000,2011))
#
#Generate out-of-the-box diagnostic plots
tiff("fluxBiasMulti_UpperTruckee__UT5_Inorg_N.tif", height = 1200, width = 1200, res=120)
fluxBiasMulti(eList, moreTitle = "WRTDS")
dev.off()
tiff("Modeled_Daily_Conc_wObservations_UpperTruckee__UT5_Inorg_N.tif", height = 800, width = 1000, res=120)
plotConcTimeDaily(eList)
dev.off()
# Exploring model behavior and adjusting model parameters
tiff("Contours_SanJVernalis_Inorg_N.tif", height = 700, width = 1000, res=120)
plotContours(eList, qBottom=0.03,qTop=5,yearStart=1990,yearEnd=2011, contourLevels=seq(0.0,0.28,by=0.005), color.palette = colorRampPalette(c("violet", "purple", "blue", "cyan", "green", "yellow", "orange", "red")))
dev.off()
tiff("Log_Contours_UpperTruckee__UT5_Inorg_N.tif", height = 700, width = 1000, res=120)
plotContours(eList, qBottom=0.03, qTop=8, yearStart=1990, yearEnd=2011, contourLevels=seq(-6.4,-1.5,by=0.1), color.palette = colorRampPalette(c("violet", "purple", "blue", "cyan", "green", "yellow", "orange", "red")), whatSurface=1)
dev.off()
tiff("StdErr_of_Log_Contours_UpperTruckee__UT5_Inorg_N.tif", height = 700, width = 1000, res=120)
plotContours(eList, qBottom=0.03, qTop=8, yearStart=1990, yearEnd=2011, contourLevels=seq(0.35,0.88,by=0.01), color.palette = colorRampPalette(c("violet", "purple", "blue", "cyan", "green", "yellow", "orange", "red")), whatSurface=2)
dev.off()
tiff("Contours_Difference_Inorg__UT5_N.tif", height = 700, width = 1000, res=120)
plotDiffContours(eList, 1990,2011,0.03,8,maxDiff=0.1)
dev.off()
tiff("Contours_PercentDifference_UT_UT5_Inorg_N.tif", height = 700, width = 1000, res=120)
plotDiffContours(eList, 1990,2011,0.03,8, maxDiff=100, plotPercent=TRUE)
dev.off()
plotDiffContours2 <- function (eList, year0, year1, qBottom, qTop, maxDiff, whatSurface = 3,
tcl = 0.1, qUnit = 2, span = 60, pval = 0.05, printTitle = TRUE,
plotPercent = FALSE, vert1 = NA, vert2 = NA, horiz = NA,
flowDuration = TRUE, yTicks = NA, tick.lwd = 2, lwd = 1,
cex.main = 0.95, cex.axis = 1, customPar = FALSE, color.palette = colorRampPalette(c("blue",
"white", "red")), ...)
{
localINFO <- getInfo(eList)
localDaily <- getDaily(eList)
localsurfaces <- getSurfaces(eList)
if (is.numeric(qUnit)) {
qUnit <- qConst[shortCode = qUnit][[1]]
}
else if (is.character(qUnit)) {
qUnit <- qConst[qUnit][[1]]
}
if (!customPar) {
par(oma = c(6, 1, 6, 0))
par(mar = c(5, 5, 4, 2) + 0.1)
}
surfaceName <- c("log of Concentration", "Standard Error of log(C)",
"Concentration")
j <- 3
j <- if (whatSurface == 1)
1
else j
j <- if (whatSurface == 2)
2
else j
surf <- localsurfaces
bottomLogQ <- localINFO$bottomLogQ
stepLogQ <- localINFO$stepLogQ
nVectorLogQ <- localINFO$nVectorLogQ
bottomYear <- localINFO$bottomYear
stepYear <- localINFO$stepYear
nVectorYear <- localINFO$nVectorYear
start0 <- ((year0 - bottomYear) * 16) + 1
end0 <- start0 + 16
start1 <- ((year1 - bottomYear) * 16) + 1
end1 <- start1 + 16
if (plotPercent) {
diff <- (surf[, start1:end1, j] - surf[, start0:end0,
j]) * 100/surf[, start0:end0, j]
}
else {
diff <- surf[, start1:end1, j] - surf[, start0:end0,
j]
}
difft <- t(diff)
if (length(maxDiff) == 1) {
surfaceSpan <- c(-maxDiff, maxDiff)
}
else {
surfaceSpan <- range(maxDiff)
}
contourLevels <- pretty(surfaceSpan, n = 50)
x <- seq(0, 1, stepYear)
y <- ((1:nVectorLogQ) * stepLogQ) + (bottomLogQ - stepLogQ)
yLQ <- y
qFactor <- qUnit@qUnitFactor
y <- exp(y) * qFactor
numX <- length(x)
numY <- length(y)
if (is.na(yTicks[1])) {
qBottom <- max(0.9 * y[1], qBottom)
qTop <- min(1.1 * y[numY], qTop)
yTicks <- logPretty3(qBottom, qTop)
yTicks2 <- c(0.028,0.056,0.141,0.283,0.566,1.415,2.831,5.663,14.15,28.31,56.63,141.5) #cfs
}
xTicks <- c(0, 0.0848, 0.1642, 0.249, 0.331, 0.416, 0.498,
0.583, 0.668, 0.75, 0.835, 0.917, 1)
xLabels <- c("Jan1", "Feb1", "Mar1", "Apr1", "May1", "Jun1",
"Jul1", "Aug1", "Sep1", "Oct1", "Nov1", "Dec1", "Jan1")
nxTicks <- length(xTicks)
nYTicks <- length(yTicks)
numDays <- length(localDaily$Day)
freq <- rep(0, nVectorLogQ)
plotTitle <- if (printTitle)
paste(localINFO$shortName, " ", localINFO$paramShortName,
"\nEstimated", surfaceName[j], "change from", year0,
"to", year1)
else ""
if (flowDuration) {
durSurf <- rep(0, 17 * nVectorLogQ)
dim(durSurf) <- c(17, nVectorLogQ)
centerDays <- seq(1, 388, 22.9)
centerDays <- floor(centerDays)
for (ix in 1:17) {
startDay <- centerDays[ix] - span
endDay <- centerDays[ix] + span
goodDays <- seq(startDay, endDay, 1)
goodDays <- ifelse(goodDays > 0, goodDays, goodDays +
365)
goodDays <- ifelse(goodDays < 366, goodDays, goodDays -
365)
numDays <- length(localDaily$Day)
isGood <- localDaily$Day %in% goodDays
spanDaily <- data.frame(localDaily, isGood)
spanDaily <- subset(spanDaily, isGood)
n <- length(spanDaily$Day)
LogQ <- spanDaily$LogQ
for (jQ in 1:nVectorLogQ) {
ind <- ifelse(LogQ < yLQ[jQ], 1, 0)
freq[jQ] <- sum(ind)/n
}
durSurf[ix, ] <- freq
}
plevels <- c(pval, 1 - pval)
pct1 <- format(plevels[1] * 100, digits = 2)
pct2 <- format(plevels[2] * 100, digits = 2)
firstLine <- paste(localINFO$shortName, "  ", localINFO$paramShortName,
sep = "")
secondLine <- if (plotPercent) {
paste("\nEstimated", surfaceName[j], "percent change from",
year0, "to", year1)
}
else {
paste("\nEstimated", surfaceName[j], "change from",
year0, "to", year1)
}
thirdLine <- paste("\nBlack lines are", pct1, "and",
pct2, "flow percentiles")
plotTitle <- paste(firstLine, secondLine, thirdLine)
}
vectorNone <- c(year0, log(yTicks[1], 10) - 1, year1, log(yTicks[1],
10) - 1)
v1 <- if (is.na(vert1))
vectorNone
else c(vert1, log(yTicks[1], 10), vert1, log(yTicks[nYTicks],
10))
v2 <- if (is.na(vert2))
vectorNone
else c(vert2, log(yTicks[1], 10), vert2, log(yTicks[nYTicks],
10))
h1 <- if (is.na(horiz))
vectorNone
else c(year0, log(horiz, 10), year1, log(horiz, 10))
deltaY <- (log(yTicks[length(yTicks)], 10) - log(yTicks[1],
10))/25
deltaX <- (1)/25
yLab <- qUnit@qUnitExpress
filled.contour(x, log(y, 10), difft, levels = contourLevels,
xlim = c(0, 1), ylim = c(log(yTicks[1], 10), log(yTicks[nYTicks],
10)), xlab = "", ylab = yLab, xaxs = "i", yaxs = "i",
cex.main = cex.main, plot.axes = {
axis(1, tcl = 0, at = xTicks, labels = xLabels, cex.axis = 0.9 *
cex.axis)
axis(2, tcl = 0, las = 1, at = log(yTicks, 10), labels = yTicks,
cex.axis = cex.axis)
axis(3, tcl = 0, at = xTicks, labels = FALSE)
axis(4, tcl = 0, at = log(yTicks2, 10), labels = c("1","2","5","10","20","50","100","200","500","1000","2000","5000"))    #edm: yTicks -> yTicks2, added labels
if (flowDuration)
contour(x, log(y, 10), durSurf, add = TRUE, drawlabels = FALSE,
levels = plevels, lwd = lwd,lty=2)  #adjust the 95% confidence intervals here
segments(v1[1], v1[2], v1[3], v1[4])
segments(v2[1], v2[2], v2[3], v2[4])
segments(h1[1], h1[2], h1[3], h1[4])
segments(xTicks, rep(log(yTicks[1], 10), length(xTicks)),
xTicks, rep(grconvertY(grconvertY(par("usr")[3],
from = "user", to = "inches") + tcl, from = "inches",
to = "user"), length(xTicks)), lwd = tick.lwd)
segments(xTicks, rep(log(yTicks[nYTicks], 10), length(xTicks)),
xTicks, rep(grconvertY(grconvertY(par("usr")[4],
from = "user", to = "inches") - tcl, from = "inches",
to = "user"), length(xTicks)), lwd = tick.lwd)
segments(rep(0, length(yTicks)), log(yTicks, 10),
rep(grconvertX(grconvertX(par("usr")[1], from = "user",
to = "inches") + tcl, from = "inches", to = "user"),
length(yTicks)), log(yTicks, 10), lwd = tick.lwd)
segments(rep(grconvertX(grconvertX(par("usr")[2],
from = "user", to = "inches") - tcl, from = "inches",
to = "user"), length(yTicks)), log(yTicks, 10),
rep(1, length(yTicks)), log(yTicks, 10), lwd = tick.lwd)
}, color.palette = color.palette, ...)
#try adding contours
par(new=T, mar=c(5.1,5.1,4.1,9.1))
contour(x, log(y, 10), difft, levels = seq(-100,200,by=50),xlim=c(0,1), ylim = c(log(yTicks[1], 10), log(yTicks[nYTicks],10)),
xaxs = "i",yaxs="i",xaxt="n",yaxt="n",labcex=1,method=c("flattest","edge")) #add=TRUE)
if (printTitle)
title(plotTitle, outer = TRUE, cex.main = cex.main, line = -3)
}
tiff("Contours_PercentDifference2_Inorg_N_SanJVernalis_DIN.tif", height = 700, width = 1000, res=120)
plotDiffContours2(eList, 1990,2011,0.05,8, maxDiff=c(-100,100), plotPercent=TRUE, lwd=3, color.palette=colorRampPalette(c("blue","lightblue","white", "orange", "red")),tick.lwd = 1)
dev.off()
Sample$WY <- trunc(Sample$DecYear+0.25)
tiff("Monthly_Boxplot_SanJVern_Inorg_N.tif", height = 700, width = 1000, res=120)
par(mar=c(4,6,0.5,0.5))
boxplot(Sample$ConcAve~Sample$WY,log="y",varwidth=TRUE,ylim=c(0.05,10),yaxs="i",xlab="Water Year",las=1)
mtext(side=2, expression(paste("Concentration, Inorganic Nitrogen, in mg  ",L^-1,sep="")),line=4)
dev.off()
################  Using the plotConcQSmooth function
###########
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1992-06-01"
date2 <- "2000-06-01"
date3 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
tiff("SanJVern_Date_Discharge_NO3_conc_no_log.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3,qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
data1 <- "1972-06-01"
data2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, data4, data5,qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, date4, date5,qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, date4, date5, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
#################  Using the plotConcQSmooth function
###########
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3,qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
plotConcQSmooth(eList,date1, date2, date3,date4 qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
plotConcQSmooth(eList,date1, date2, date3,date4, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
plotConcQSmooth(eList,date1, date2, date3, date4, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
#################  Using the plotConcQSmooth function
###########
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2019-06-01"
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2009-06-01"
date6 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
tiff("SanJVern_Date_Discharge_NO3_conc_no_log1.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
#################  Using the plotConcQSmooth function
###########
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2009-06-01"
date6 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log1.tif",height = 700, width = 1000, res=120)
#plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
#dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log1.tif",height = 700, width = 1000, res=120)
#plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
#dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log2.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0)#printTitle=TRUE)
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =FALSE,legendLeft=0,legendTop=0)#printTitle=TRUE)
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log_first30years.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log_last30years.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0, printTitle=TRUE)
#################  Using the plotConcQSmooth function
###########
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2009-06-01"
date6 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log_first30years.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log_last30years.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0, printTitle=TRUE)
dev.off()
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log_1st.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
###This is a script taken from another study, but we will do the same thing for the PES project
##So, the script needs to be modifed for the Vernalis site
# Load required libraries
library(EGRET)
library(dataRetrieval)
library(rloadest)
library(EGRETci)
library(foreach)
library(doParallel)
library(iterators)
library(zoo)
library(plotrix)
library(lubridate)
library(changepoint)
library(corrplot)
library(RColorBrewer)
library(plotly)
library(ggplot2)
library(viridis)
library(fields)
library(extrafont)
loadfonts()
################  Using the plotConcQSmooth function
###########
#First do flow duration analysis
flowDuration(eList, centerDate = "06-01", qUnit = 2, span = 30)
date1 <- "1972-06-01"
date2 <- "1982-06-01"
date3 <- "1992-06-01"
date4 <- "2000-06-01"
date5 <- "2009-06-01"
date6 <- "2019-06-01"
qLow= baseQ
qHigh=highQ7
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log_1st.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
dev.off()
tiff("SanJVern_Date_Discharge_NO3_conc_no_log_last30years.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date4, date5, date6, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0, printTitle=TRUE)
dev.off()
#tiff("SanJVern_Date_Discharge_NO3_conc_no_log1st.tif",height = 700, width = 1000, res=120)
plotConcQSmooth(eList,date1, date2, date3, qLow, qHigh, logScale=FALSE,printLegend =TRUE,legendLeft=0,legendTop=0,printTitle=TRUE)
